FROM --platform=i386 i386/debian:buster
ARG DEBIAN_FRONTEND=noninteractive

# Update and upgrade the system
RUN apt-get clean && apt-get update && apt-get -y upgrade

# Install necessary packages, including python3-pip and git
RUN apt-get -y install apt-utils gcc \
    python3 python3-pip vim unzip ruby nodejs \
    git fakeroot dbus base whiptail hexedit \
    patch wamerican ucf manpages \
    file luajit make lua50 dialog curl \
    less cowsay netcat-openbsd

# Create a new user named 'user' with password 'password'
RUN useradd -m user && echo "user:password" | chpasswd

# Install aider using pip
RUN python3 -m pip install aider-install

# Run the aider installation script
RUN aider-install

# Clone the specified GitHub repository into the 'template' folder
RUN git clone https://github.com/Nyttja-Labs/Template-server-experiment.git template && \
    chown -R user:user template

# Copy the 'examples' directory to the user's home directory with proper ownership
COPY --chown=user:user ./examples /home/user/examples

# Make all scripts in the 'lua' directory executable
RUN chmod -R +x /home/user/examples/lua

# Set the working directory
WORKDIR /home/user/template

# Set environment variables
ENV HOME="/home/user" \
    TERM="xterm" \
    USER="user" \
    SHELL="/bin/bash" \
    EDITOR="vim" \
    LANG="en_US.UTF-8" \
    LC_ALL="C"

# Set the root password to 'password'
RUN echo 'root:password' | chpasswd

# Specify the default command to run
CMD [ "/bin/bash" ]
